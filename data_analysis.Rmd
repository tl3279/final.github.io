---
title: "Data Analysis"
output: 
  html_document:
    toc: true
    toc_float:
      smooth_scroll: true
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(message = FALSE, warning = FALSE)
library(tidyverse)
library(haven)
library(VGAM)
```

## Data Importing and Cleaning

Visit [report](report.html) for detailed steps on how the data is cleaned.
```{r}
brfss_22 = read_csv("NYSDOH_BRFSS_Survey_Data_2022.csv")|>
  janitor::clean_names()

cleaned_df = 
  brfss_22 |>
  filter(complete.cases(imprace, educag, incomg1, strsmeal_sa, genhlth, diabete4, ment14d, phys14d))|>
  select(imprace, educag, incomg1, strsmeal_sa, genhlth, diabete4, ment14d, phys14d)

cleaned_df = 
  cleaned_df |>
  mutate(
    income = case_when(
      incomg1 %in% c("Less than $15,000", "$25,000 to < $35,000", "$35,000 to < $50,000") ~"<50,000",
      incomg1 == "$50,000 to < $100,000" ~ "50,000 ~ 100,000",
      incomg1 %in% c ("$100,000 to < $200,000" , "$200,000 or more") ~ ">100,000",
      TRUE ~ NA_character_),
    
    education = case_when(
      educag == "Did not graduate High School" ~ "Less than high school",
      educag == "Graduated High School" ~ "High school or GED",
      educag == "Attended College or Technical School" ~ "Some post-high school",
      educag == "Graduated from College or Technical School" ~ "College graduate"
    ),
    
    food_insecure = case_when(
      strsmeal_sa %in% c("Rarely","Sometimes","Usually", "Always") ~ 1,
      strsmeal_sa == "Never" ~ 0),
    
    health = case_when(
      genhlth %in% c("Good", "Very good", "Excellent") ~ 1,
      genhlth %in% c("Fair", "Poor") ~ 0),
    
    physical_health = case_when(
      phys14d %in% c("Zero days when physical health not good") ~ 1,
      phys14d %in% c("1-13 days when physical health not good", "14+ days when physical health not good") ~ 0),
    
    mental_health = case_when(
      ment14d %in% c("Zero days when mental health not good") ~ 1,
      ment14d %in% c("1-13 days when mental health not good", "14+ days when physical health not good") ~ 0),
    
    diabete = case_when(
      diabete4 %in% c("No") ~0,
      diabete4%in% c("Yes") ~ 1)
    
   )|>
  filter(!is.na(income), !is.na(education), !is.na(physical_health), !is.na(mental_health), !is.na(diabete))|>
  select(-incomg1, -educag, -strsmeal_sa, -genhlth, -phys14d, -ment14d, -diabete4)

```



## Key Socioeconomic Factors Distribution
### Race
```{r, fig.height=8,fig.width=8,}
ggplot(data = cleaned_df, aes(x = imprace, fill = imprace))+
  geom_bar() +
  labs(
    title = "Distribution of Race/Ethnicity",
    x = "Race/Ethnicity",
    y = "Count"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) 
```



This bar graph illustrates the distribution of race/ethnicity in the dataset. The categories include American Indian/Alaskan Native, Asian, Black, Hispanic, Other Race, and White, all specified as Non-Hispanic except for the Hispanic group. Among these groups, White, Non-Hispanic individuals dominate, with the highest count exceeding 6,000. The second most prevalent group is Hispanic, followed by Black, Non-Hispanic, while Other Race, Non-Hispanic, and Asian, Non-Hispanic, show significantly smaller counts. The American Indian/Alaskan Native, Non-Hispanic category represents the smallest group. 

### Education
```{r}
ggplot(cleaned_df, aes(x = "", fill = education)) +
  geom_bar(width = 1, stat = "count") +
  coord_polar(theta = "y") +
  labs(
    title = "Distribution of Education Levels",
    fill = "Education Level"
  ) +
  theme_void() +
  theme(legend.position = "right")
```




This pie chart shows the distribution of education levels within a dataset. The largest portion of the chart is represented by college graduates, shown in red, indicating that a significant proportion of individuals have completed higher education. The second-largest category, represented in purple, corresponds to individuals with some post-high school education. High school graduates or those with a GED, shown in green, form a smaller segment, while the smallest portion of the chart, in teal, represents individuals with less than a high school education. 

### Food Insecurity
```{r}
ggplot(cleaned_df, aes(x = as.factor(food_insecure), fill = as.factor(food_insecure))) +
  geom_bar() +
  scale_fill_manual(values = c("0" = "lightblue", "1" = "pink"), labels = c("Not Food Insecure", "Food Insecure")) +
  labs(
    title = "Distribution of Food Insecurity",
    x = "Food Insecurity",
    y = "Count",
    fill = "Status"
  ) +
  theme_minimal()
```




This bar graph presents the distribution of food insecurity status among individuals in the dataset. The largest group, represented in light blue, comprises individuals who are not food insecure, with a count exceeding 4,000. The second-largest group, shown in pink, represents individuals who are food insecure, numbering slightly over 2,000. A very small proportion, represented in gray, corresponds to missing data (NA) for food insecurity status. 


```{r}
cleaned_df = 
  cleaned_df |>
  mutate(
    imprace = as.factor(imprace),
    income = as.factor(income),
    education = as.factor(education)
  )
```


## Logistic Regression Models

### Is Income Associated With Food Insecure? 
#### Odds Ratio
```{r}
logit_income = 
  glm(formula = food_insecure ~ income, data = cleaned_df, family = binomial)

exp_income = exp(cbind(OR=coef(logit_income),confint(logit_income)))

rownames(exp_income) = gsub("income", "", rownames(exp_income))

knitr::kable(exp_income)
```

#### Confidence Interval
```{r}
ci_income = as.data.frame(exp_income)
ci_income = 
  ci_income |> 
  rownames_to_column("Variable") |> 
  filter(Variable != "(Intercept)") |>
ggplot(aes(y = Variable, x = OR, xmin = `2.5 %`, xmax = `97.5 %`)) +
  geom_pointrange() +
  geom_vline(xintercept = 1, linetype = "dashed", color = "red") +
  labs(
    title = "Odds Ratios with 95% Confidence Intervals",
    x = "Odds Ratio (OR)",
    y = "Income Category"
  ) +
  theme_minimal() +
  theme(axis.text.y = element_text(size = 12))
ci_income
```

Intercept: The odds ratio for the intercept (1.171) represents the baseline odds of being food insecure when income is less than 50,000. Since the 95% confidence interval (1.079–1.272) does not include 1, it is statistically significant.

OR: 
   Income > 100,000: The odds ratio (0.166) indicates that individuals with an income greater than $100,000 have 83.4% lower odds of being food insecure compared to the income group less than 50,000. 

   Income 50,000–100,000: The odds ratio (0.349) indicates that individuals with an income between $50,000 and 100,000 have 65.1% lower odds of being food insecure compared to the income group less than 50,000. 
   
Statistical significance: confidence intervals of OR of both predictor levels exclude 1, indicating that they are statistically associated with food insecure. 


### Is Race Associated With Food Insecure?
#### Odds Ratio
```{r}
logit_race = 
  glm(food_insecure ~ imprace, data = cleaned_df, family = binomial)

exp_race = exp(cbind(OR=coef(logit_race),confint(logit_race)))

rownames(exp_race) = gsub("imprace", "", rownames(exp_race))

knitr::kable(exp_race)
```

#### Confidence Interval
```{r}
ci_race = as.data.frame(exp_race)
ci_race = 
  ci_race |> 
  rownames_to_column("Variable") |> 
  filter(Variable != "(Intercept)") |>
ggplot(aes(y = Variable, x = OR, xmin = `2.5 %`, xmax = `97.5 %`)) +
  geom_pointrange() +
  geom_vline(xintercept = 1, linetype = "dashed", color = "red") +
  labs(
    title = "Odds Ratios with 95% Confidence Intervals",
    x = "Odds Ratio (OR)",
    y = "Race Category"
  ) +
  theme_minimal() +
  theme(axis.text.y = element_text(size = 12))
ci_race
```


Intercept: The odds ratio for the intercept (1.6) represents the odds of being food insecure for the reference group (American Indian/Alaskan Native). 

OR:
   Asian, Non-Hispanic: The odds ratio (0.318) indicates that Asian, Non-Hispanic individuals have 68.2% lower odds of being food insecure compared to American Indians. 

   Black, Non-Hispanic: The odds ratio (0.528) suggests that Black, Non-Hispanic individuals have 47.2% lower odds of being food insecure compared to American Indians.

   Hispanic: The odds ratio (0.832) implies that Hispanic individuals have 16.8% lower odds of being food insecure compared to American Indians. 

   Other Race, Non-Hispanic: The odds ratio (0.426) indicates that individuals of Other Race, Non-Hispanic have 57.4% lower odds of being food insecure compared to American Indians. 

   White, Non-Hispanic: The odds ratio (0.230) suggests that White, Non-Hispanic individuals have 77% lower odds of being food insecure compared to American Indians. 

Statistical significance: confidence intervals of OR of all predictor levels except Black and Hispanic exclude 1, indicating that these predictor levels are statistically significant. 


### Is Education Associated With Food Insecure?
#### Odds Ratio
```{r}
logit_edu = 
  glm(food_insecure ~ education, data = cleaned_df, family = binomial)

exp_edu = exp(cbind(OR=coef(logit_edu),confint(logit_edu)))

rownames(exp_edu) = gsub("education", "", rownames(exp_edu))

knitr::kable(exp_edu)
```

#### Confidence Interval
```{r}
ci_edu = as.data.frame(exp_edu)
ci_edu = 
  ci_edu |> 
  rownames_to_column("Variable") |> 
  filter(Variable != "(Intercept)") |>
ggplot(aes(y = Variable, x = OR, xmin = `2.5 %`, xmax = `97.5 %`)) +
  geom_pointrange() +
  geom_vline(xintercept = 1, linetype = "dashed", color = "red") +
  labs(
    title = "Odds Ratios with 95% Confidence Intervals",
    x = "Odds Ratio (OR)",
    y = "Education Category"
  ) +
  theme_minimal() +
  theme(axis.text.y = element_text(size = 12))
ci_edu
```

Intercept: The odds ratio for the intercept (0.309) represents the odds of being food insecure for individuals in the reference group (College graduates). 

OR:
   High School or GED: The odds ratio (2.444) indicates that individuals with a high school diploma or GED have 144.4% higher odds of being food insecure compared to college graduates. 

   Less than High School: The odds ratio (5.241) suggests that individuals with less than a high school education have 424.1% higher odds of being food insecure compared to college graduates. 

   Some Post-High School: The odds ratio (2.119) indicates that individuals with some post-high school education have 111.9% higher odds of being food insecure compared to college graduates. 

Statistical significance: confidence intervals of OR of all three predictor levels exclude 1, making these results statistically significant. 


### Are Race, Education, and Income Associated With Food Insecure?
#### Odds Ratio
```{r}
logit_all = 
  glm(food_insecure ~ education + income + imprace, data = cleaned_df, family = binomial)

exp_all = exp(cbind(OR=coef(logit_all),confint(logit_all)))

rownames(exp_all) = gsub("education|income|imprace", "", rownames(exp_all))

knitr::kable(exp_all)
```

#### Confidence Interval
```{r}
ci_all = as.data.frame(exp_all)
ci_all = 
  ci_all |> 
  rownames_to_column("Variable") |> 
  filter(Variable != "(Intercept)") |>
ggplot(aes(y = Variable, x = OR, xmin = `2.5 %`, xmax = `97.5 %`)) +
  geom_pointrange() +
  geom_vline(xintercept = 1, linetype = "dashed", color = "red") +
  labs(
    title = "Odds Ratios with 95% Confidence Intervals",
    x = "Odds Ratio (OR)",
    y = "Categories"
  ) +
  theme_minimal() +
  theme(axis.text.y = element_text(size = 12))
ci_all
```


Statistical Significant Predictors: 

Education:
   Individuals with a high school diploma or GED have 40.1% higher odds of being food insecure compared to college graduates. 
   Individuals with less than a high school education have 67.1% higher odds of being food insecure compared to college graduates. 
   Individuals with some post-high school education have 49.1% higher odds of being food insecure compared to college graduates. 
    
Income: 
   Individuals earning over 100,000 have 77.2% lower odds of being food insecure compared to those earning ≤ $50,000.
   Individuals earning between $50,000 and $100,000 have 56.3% lower odds of being food insecure compared to those earning ≤ $50,000. 
   
Race/Ethnicity:
   White, Non-Hispanic individuals have 61.4% lower odds of being food insecure compared to American Indians.
   
Summary: 
   Education and income levels show significant associations with food insecurity, with lower education and income levels increasing odds of food insecurity.Among racial/ethnic groups, only White, Non-Hispanic individuals show significantly lower odds of food insecurity compared to American Indians.