---
title: "Data Analysis"
output: 
  html_document:
    toc: true
    toc_float:
      smooth_scroll: true
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(message = FALSE, warning = FALSE)
library(tidyverse)
library(haven)
library(VGAM)
```

## Data Importing and Cleaning
Visit [report](report.html) for detailed steps on how the data is cleaned.
```{r}
brfss_22 = read_csv("NYSDOH_BRFSS_Survey_Data_2022.csv")|>
  janitor::clean_names()

cleaned_df = 
  brfss_22 |>
  filter(complete.cases(imprace, educag, incomg1, strsmeal_sa, genhlth, diabete4, ment14d, phys14d))|>
  select(imprace, educag, incomg1, strsmeal_sa, genhlth, diabete4, ment14d, phys14d)

cleaned_df = 
  cleaned_df |>
  mutate(
    income = case_when(
      incomg1 %in% c("Less than $15,000", "$25,000 to < $35,000", "$35,000 to < $50,000") ~"<50,000",
      incomg1 == "$50,000 to < $100,000" ~ "50,000 ~ 100,000",
      incomg1 %in% c ("$100,000 to < $200,000" , "$200,000 or more") ~ ">100,000",
      TRUE ~ NA_character_),
    
    education = case_when(
      educag == "Did not graduate High School" ~ "Less than high school",
      educag == "Graduated High School" ~ "High school or GED",
      educag == "Attended College or Technical School" ~ "Some post-high school",
      educag == "Graduated from College or Technical School" ~ "College graduate"
    ),
    
    food_insecure = case_when(
      strsmeal_sa %in% c("Rarely","Sometimes","Usually", "Always") ~ 1,
      strsmeal_sa == "Never" ~ 0),
    
    health = case_when(
      genhlth %in% c("Good", "Very good", "Excellent") ~ 1,
      genhlth %in% c("Fair", "Poor") ~ 0),
    
    physical_health = case_when(
      phys14d %in% c("Zero days when physical health not good") ~ 1,
      phys14d %in% c("1-13 days when physical health not good", "14+ days when physical health not good") ~ 0),
    
    mental_health = case_when(
      ment14d %in% c("Zero days when mental health not good") ~ 1,
      ment14d %in% c("1-13 days when mental health not good", "14+ days when physical health not good") ~ 0),
    
    diabete = case_when(
      diabete4 %in% c("No") ~0,
      diabete4%in% c("Yes") ~ 1)

   )|>
  filter(!is.na(income), !is.na(education), !is.na(physical_health), !is.na(mental_health), !is.na(diabete))|>
  select(-incomg1, -educag, -strsmeal_sa, -genhlth, -phys14d, -ment14d, -diabete4)

```

We are interested in understanding the associations between food insecurity and its potential impacts on various health outcomes, including general health, physical health, mental health, and diabetes. 

## General Health
### Odds Ratio
```{r}
logit_health = 
  glm(health ~ food_insecure, data = cleaned_df, family = binomial)

exp_health = exp(cbind(OR=coef(logit_health),confint(logit_health)))

knitr::kable(exp_health)
```

### Confidence Interval

```{r}
ci_general = as.data.frame(exp_health)
ci_general = 
  ci_general |> 
  rownames_to_column("Variable") |> 
  filter(Variable != "(Intercept)") |>
ggplot(aes(y = Variable, x = OR, xmin = `2.5 %`, xmax = `97.5 %`)) +
  geom_pointrange() +
  geom_vline(xintercept = 1, linetype = "dashed", color = "red") +
  labs(
    title = "Odds Ratios with 95% Confidence Intervals",
    x = "Odds Ratio (OR)",
    y = "General Health Category"
  ) +
  theme_minimal() +
  theme(axis.text.y = element_text(size = 12))
ci_general
```

OR interpretation: Individuals who are food insecure have approximately 53% lower odds of having good health compared to those who are not food insecure, holding all else constant. 
Because this result shows that food insecure is a potential risk factor for general health of individuals, we want to further explore the association between food insecure with physical health and mental health, separately. 


## Physical Health
### Odds Ratio
```{r}
logit_physical = 
  glm(physical_health ~ food_insecure, data = cleaned_df, family = binomial)

exp_physical = exp(cbind(OR=coef(logit_physical),confint(logit_physical)))

knitr::kable(exp_physical)
```

### Confidence Interval
```{r}
ci_physical = as.data.frame(exp_physical)
ci_physical = 
  ci_physical |> 
  rownames_to_column("Variable") |> 
  filter(Variable != "(Intercept)") |>
ggplot(aes(y = Variable, x = OR, xmin = `2.5 %`, xmax = `97.5 %`)) +
  geom_pointrange() +
  geom_vline(xintercept = 1, linetype = "dashed", color = "red") +
  labs(
    title = "Odds Ratios with 95% Confidence Intervals",
    x = "Odds Ratio (OR)",
    y = "Physical Health Category"
  ) +
  theme_minimal() +
  theme(axis.text.y = element_text(size = 12))
ci_physical
```

OR interpretation: Individuals who are food insecure have approximately 37.7% lower odds of having good physical health compared to those who are not food insecure, holding all else constant.
Therefore, food insecure is associated with physical health.


## Mental Health
### Odds Ratio
```{r}
logit_mental = 
  glm(mental_health ~ food_insecure, data = cleaned_df, family = binomial)

exp_mental = exp(cbind(OR=coef(logit_mental),confint(logit_mental)))

knitr::kable(exp_mental)
```


### Confidence Interval
```{r}
ci_mental = as.data.frame(exp_mental)
ci_mental = 
  ci_mental |> 
  rownames_to_column("Variable") |> 
  filter(Variable != "(Intercept)") |>
ggplot(aes(y = Variable, x = OR, xmin = `2.5 %`, xmax = `97.5 %`)) +
  geom_pointrange() +
  geom_vline(xintercept = 1, linetype = "dashed", color = "red") +
  labs(
    title = "Odds Ratios with 95% Confidence Intervals",
    x = "Odds Ratio (OR)",
    y = "Physical Health Category"
  ) +
  theme_minimal() +
  theme(axis.text.y = element_text(size = 12))
ci_mental
```

OR interpretation: Individuals who are food insecure have approximately 49.9% lower odds of having good mental health compared to those who are not food insecure, holding all else constant.
Therefore, food insecure is associated with mental health.

Results show that food insecure have impacts on both individuals' physical and mental health, separately. Then we move on to explore how food insecure affects diabetes which is a main outcome of malnutrition. 


## Diabetes
### Odds Ratio
```{r}
logit_diabete = 
  glm(diabete ~ food_insecure, data = cleaned_df, family = binomial)

exp_diabete = exp(cbind(OR=coef(logit_diabete),confint(logit_diabete)))

knitr::kable(exp_diabete)
```


### Confidence Interval
```{r}
ci_diabete = as.data.frame(exp_diabete)
ci_diabete = 
  ci_diabete |> 
  rownames_to_column("Variable") |> 
  filter(Variable != "(Intercept)") |>
ggplot(aes(y = Variable, x = OR, xmin = `2.5 %`, xmax = `97.5 %`)) +
  geom_pointrange() +
  geom_vline(xintercept = 1, linetype = "dashed", color = "red") +
  labs(
    title = "Odds Ratios with 95% Confidence Intervals",
    x = "Odds Ratio (OR)",
    y = "Physical Health Category"
  ) +
  theme_minimal() +
  theme(axis.text.y = element_text(size = 12))
ci_diabete
```

OR interpretation: Individuals who are food insecure have approximately 27.4% higher odds of having diabetes compared to those who are not food insecure, holding all else constant.
Food insecure is associated with diabetes. 
